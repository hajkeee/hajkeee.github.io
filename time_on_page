<script>

  window.pageLoadTime = new Date().getTime();
  window.isEventSent = false;

  function sendTimeSpent() {
    if (!window.isEventSent) {
      var timeSpent = Math.round((new Date().getTime() - window.pageLoadTime) / 1000);
      window.isEventSent = true;
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({
        'event': 'timeOnPage',
        'timeSpent': timeSpent
      });
    }
  }


  window.addEventListener('visibilitychange', function() {
    if (document.visibilityState === 'hidden') {
      sendTimeSpent();
    }
  });

  window.addEventListener('beforeunload', function() {
    sendTimeSpent();
  });
</script>
