<script>
  window.addEventListener('DOMContentLoaded', function () {
    const event = window.dataLayer.find(e => e.event === 'Purchase');
    if (event) {
      const clone = structuredClone(event);
      sessionStorage.setItem('purchaseData', JSON.stringify(clone));
    }
  });
</script>

v2
<script>
  window.addEventListener('DOMContentLoaded', function () {
    var purchaseEvent = window.dataLayer.find(e => e.event === 'purchase');
    if (purchaseEvent) {
      try {
        var clone = JSON.parse(JSON.stringify(purchaseEvent));
        sessionStorage.setItem('purchaseData', JSON.stringify(clone));
      } catch (e) {
        console.error('Cloning failed', e);
      }
    }
  });
</script>





Restore Purchase Event from SessionStorage

<script>
  window.addEventListener('DOMContentLoaded', function () {
    if (!sessionStorage.getItem('purchaseData') || sessionStorage.getItem('purchaseTransferred')) {
      return;
    }

    try {
      const purchase = JSON.parse(sessionStorage.getItem('purchaseData'));
      if (purchase) {
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push(purchase);
        sessionStorage.setItem('purchaseTransferred', 'true'); 
      }
    } catch (e) {
      console.error('Failed to restore purchase', e);
    }
  });
</script>

v2
<script>
  window.addEventListener('DOMContentLoaded', function () {
    if (!sessionStorage.getItem('purchaseData') || sessionStorage.getItem('purchaseTransferred')) return;

    try {
      var purchase = JSON.parse(sessionStorage.getItem('purchaseData'));
      if (purchase) {
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push(purchase);
        sessionStorage.setItem('purchaseTransferred', 'true');
      }
    } catch (e) {
      console.error('Failed to restore purchase', e);
    }
  });
</script>
